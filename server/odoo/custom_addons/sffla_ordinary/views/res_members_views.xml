<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_res_members_form_with_header" model="ir.ui.view">
        <field name="name">res.members.form</field>
        <field name="model">res.members</field>
        <field name="arch" type="xml">
            <form string="Member">
                    <header>
                        <button name="action_set_active"
                                type="object"
                                string="Set Active"
                                class="btn-primary"
                                invisible="[['membership_status','=','active']]"/>

                        <button name="action_set_expired"
                                type="object"
                                string="Set Expired"
                                class="btn-secondary"
                                invisible="[['membership_status','=','expired']]"/>

                        <button name="action_set_cancelled"
                                type="object"
                                string="Cancel"
                                class="btn-danger"
                                invisible="[['membership_status','=','cancelled']]"/>

                        <field name="membership_status"
                               widget="statusbar"
                               statusbar_visible="new,active,expired,cancelled"/>
                    </header>

                    <sheet>
                        <group>
                            <field name="membership_number" readonly="1"/>
                            <field name="membership_status" readonly="1"/>
                            <field name="membership_type"/>
                            <field name="partner_id"/>
                            <field name="join_month"/>
                            <field name="join_year"/>
                        </group>
                    </sheet>
            </form>
        </field>
    </record>


    <!-- Partner Form View -->
    <record id="view_partner_form_inherit_membership" model="ir.ui.view">
        <field name="name">res.partner.form.inherit.membership</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <!-- Insert after VAT field -->
            <field name="vat" position="after">
                <field name="membership_number" readonly="1"/>
            </field>
        </field>
    </record>

    <!-- Partner Tree (List) View -->
    <record id="view_partner_tree_inherit_membership" model="ir.ui.view">
        <field name="name">res.partner.tree.inherit.membership</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
            <field name="phone" position="after">
                <field name="membership_number"/>
            </field>
        </field>
    </record>

    <!-- Partner Kanban View -->
    <record id="view_partner_kanban_inherit_membership" model="ir.ui.view">
        <field name="name">res.partner.kanban.inherit.membership</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_kanban_view"/>
        <field name="arch" type="xml">
            <xpath expr="//div[contains(@class, 'oe_kanban_details')]" position="inside">
                <div>
                    <span class="o_field_char">
                        <strong>Membership:</strong>
                        <field name="membership_number"/>
                    </span>
                </div>
            </xpath>

        </field>
    </record>

    <!-- Partner Form View with Membership Tab -->
    <record id="view_partner_form_inherit_membership_tab" model="ir.ui.view">
        <field name="name">res.partner.form.inherit.membership.tab</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <notebook position="inside">
                <page string="Membership" name="membership_tab">
                    <group>
                        <field name="membership_number" readonly="1"/>
                        <field name="membership_id" context="{'default_partner_id': active_id}">
                            <tree string="Membership" editable="false">
                                <field name="membership_number"/>
                                <field name="membership_status"/>
                                <field name="membership_type"/>
                                <field name="join_month"/>
                                <field name="join_year"/>
                            </tree>
                            <form string="Membership">
                                <sheet>
                                    <group>
                                        <field name="membership_number" readonly="1"/>
                                        <field name="membership_status"/>
                                        <field name="membership_type"/>
                                        <field name="join_month"/>
                                        <field name="join_year"/>
                                    </group>
                                </sheet>
                            </form>
                        </field>
                    </group>
                </page>
            </notebook>
        </field>
    </record>

    <!-- Tree View -->
    <record id="view_res_members_tree" model="ir.ui.view">
        <field name="name">res.members.tree</field>
        <field name="model">res.members</field>
        <field name="arch" type="xml">
            <tree string="Members">
                <field name="membership_status"/>
                <field name="membership_number"/>
                <field name="partner_id"/>
                <field name="join_month"/>
                <field name="join_year"/>
            </tree>
        </field>
    </record>

    <!-- Action -->
    <record id="action_res_members" model="ir.actions.act_window">
        <field name="name">Members</field>
        <field name="res_model">res.members</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Root Menu -->
    <menuitem id="membership_menu_root"
              name="Membership"
              sequence="1"
              web_icon="subscription_package,static/description/icon.png"/>

    <!-- Submenu pointing to action -->
    <menuitem id="menu_res_members"
              name="Members"
              parent="membership_menu_root"
              action="action_res_members"
              sequence="1"/>
</odoo>
